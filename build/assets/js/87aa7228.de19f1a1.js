"use strict";(self.webpackChunkremix_docs=self.webpackChunkremix_docs||[]).push([[6243],{5136:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var s=n(4848),t=n(8453);const c={title:"entry.server",toc:!1},o="entry.server",d={id:"file-conventions/entry.server",title:"entry.server",description:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRemix \u5c06\u4e3a\u60a8\u5904\u7406 HTTP \u54cd\u5e94\u7684\u751f\u6210\u3002\u5982\u679c\u60a8\u60f3\u81ea\u5b9a\u4e49\u6b64\u884c\u4e3a\uff0c\u53ef\u4ee5\u8fd0\u884c npx remix reveal \u751f\u6210\u4e00\u4e2a app/entry.server.tsx\uff08\u6216 .jsx\uff09\uff0c\u8be5\u6587\u4ef6\u5c06\u4f18\u5148\u4f7f\u7528\u3002\u8be5\u6a21\u5757\u7684 default \u5bfc\u51fa\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5141\u8bb8\u60a8\u521b\u5efa\u54cd\u5e94\uff0c\u5305\u62ec HTTP \u72b6\u6001\u3001\u5934\u90e8\u548c HTML\uff0c\u4f7f\u60a8\u53ef\u4ee5\u5b8c\u5168\u63a7\u5236\u6807\u8bb0\u7684\u751f\u6210\u548c\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u65b9\u5f0f\u3002",source:"@site/docs/file-conventions/entry.server.md",sourceDirName:"file-conventions",slug:"/file-conventions/entry.server",permalink:"/docs/file-conventions/entry.server",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/file-conventions/entry.server.md",tags:[],version:"current",frontMatter:{title:"entry.server",toc:!1},sidebar:"tutorialSidebar",previous:{title:"entry.client",permalink:"/docs/file-conventions/entry.client"},next:{title:"remix.config.js",permalink:"/docs/file-conventions/remix-config"}},i={},l=[{value:"<code>handleDataRequest</code>",id:"handledatarequest",level:2},{value:"<code>handleError</code>",id:"handleerror",level:2},{value:"\u6d41\u5f0f\u6e32\u67d3\u9519\u8bef",id:"\u6d41\u5f0f\u6e32\u67d3\u9519\u8bef",level:3},{value:"\u629b\u51fa\u54cd\u5e94",id:"\u629b\u51fa\u54cd\u5e94",level:3}];function a(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"entryserver",children:"entry.server"})}),"\n",(0,s.jsxs)(r.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRemix \u5c06\u4e3a\u60a8\u5904\u7406 HTTP \u54cd\u5e94\u7684\u751f\u6210\u3002\u5982\u679c\u60a8\u60f3\u81ea\u5b9a\u4e49\u6b64\u884c\u4e3a\uff0c\u53ef\u4ee5\u8fd0\u884c ",(0,s.jsx)(r.code,{children:"npx remix reveal"})," \u751f\u6210\u4e00\u4e2a ",(0,s.jsx)(r.code,{children:"app/entry.server.tsx"}),"\uff08\u6216 ",(0,s.jsx)(r.code,{children:".jsx"}),"\uff09\uff0c\u8be5\u6587\u4ef6\u5c06\u4f18\u5148\u4f7f\u7528\u3002\u8be5\u6a21\u5757\u7684 ",(0,s.jsx)(r.code,{children:"default"})," \u5bfc\u51fa\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5141\u8bb8\u60a8\u521b\u5efa\u54cd\u5e94\uff0c\u5305\u62ec HTTP \u72b6\u6001\u3001\u5934\u90e8\u548c HTML\uff0c\u4f7f\u60a8\u53ef\u4ee5\u5b8c\u5168\u63a7\u5236\u6807\u8bb0\u7684\u751f\u6210\u548c\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u65b9\u5f0f\u3002"]}),"\n",(0,s.jsxs)(r.p,{children:["\u8be5\u6a21\u5757\u5e94\u4f7f\u7528 ",(0,s.jsx)(r.code,{children:"<RemixServer>"})," \u5143\u7d20\u6e32\u67d3\u5f53\u524d\u9875\u9762\u7684\u6807\u8bb0\uff0c\u5e76\u4f20\u5165\u5f53\u524d\u8bf7\u6c42\u7684 ",(0,s.jsx)(r.code,{children:"context"})," \u548c ",(0,s.jsx)(r.code,{children:"url"}),"\u3002\u4e00\u65e6 JavaScript \u5728\u6d4f\u89c8\u5668\u4e2d\u52a0\u8f7d\uff0c\u8fd9\u4e9b\u6807\u8bb0\u5c06\uff08\u53ef\u9009\u5730\uff09\u88ab\u91cd\u65b0\u6c34\u5408\uff0c\u4f7f\u7528 ",(0,s.jsx)(r.a,{href:"./entry.client",children:"browser entry module"}),"\u3002"]}),"\n",(0,s.jsx)(r.h2,{id:"handledatarequest",children:(0,s.jsx)(r.code,{children:"handleDataRequest"})}),"\n",(0,s.jsxs)(r.p,{children:["\u60a8\u53ef\u4ee5\u5bfc\u51fa\u4e00\u4e2a\u53ef\u9009\u7684 ",(0,s.jsx)(r.code,{children:"handleDataRequest"})," \u51fd\u6570\uff0c\u8fd9\u5c06\u5141\u8bb8\u60a8\u4fee\u6539\u6570\u636e\u8bf7\u6c42\u7684\u54cd\u5e94\u3002\u8fd9\u4e9b\u8bf7\u6c42\u4e0d\u4f1a\u6e32\u67d3 HTML\uff0c\u800c\u662f\u5728\u5ba2\u6237\u7aef\u6c34\u5408\u5b8c\u6210\u540e\u5c06\u52a0\u8f7d\u5668\u548c\u64cd\u4f5c\u6570\u636e\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\u3002"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-tsx",children:'export function handleDataRequest(\n  response: Response,\n  {\n    request,\n    params,\n    context,\n  }: LoaderFunctionArgs | ActionFunctionArgs\n) {\n  response.headers.set("X-Custom-Header", "value");\n  return response;\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"handleerror",children:(0,s.jsx)(r.code,{children:"handleError"})}),"\n",(0,s.jsxs)(r.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRemix \u4f1a\u5c06\u9047\u5230\u7684\u670d\u52a1\u5668\u7aef\u9519\u8bef\u8bb0\u5f55\u5230\u63a7\u5236\u53f0\u3002\u5982\u679c\u60a8\u5e0c\u671b\u66f4\u597d\u5730\u63a7\u5236\u65e5\u5fd7\u8bb0\u5f55\uff0c\u6216\u5e0c\u671b\u5c06\u8fd9\u4e9b\u9519\u8bef\u62a5\u544a\u5230\u5916\u90e8\u670d\u52a1\uff0c\u5219\u53ef\u4ee5\u5bfc\u51fa\u4e00\u4e2a\u53ef\u9009\u7684 ",(0,s.jsx)(r.code,{children:"handleError"})," \u51fd\u6570\uff0c\u8fd9\u5c06\u4f7f\u60a8\u83b7\u5f97\u63a7\u5236\u6743\uff08\u5e76\u5c06\u7981\u7528\u5185\u7f6e\u7684\u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\uff09\u3002"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-tsx",children:"export function handleError(\n  error: unknown,\n  {\n    request,\n    params,\n    context,\n  }: LoaderFunctionArgs | ActionFunctionArgs\n) {\n  if (!request.signal.aborted) {\n    sendErrorToErrorReportingService(error);\n    console.error(formatErrorForJsonLogging(error));\n  }\n}\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.em,{children:"\u8bf7\u6ce8\u610f\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u60a8\u8981\u907f\u514d\u5728\u8bf7\u6c42\u88ab\u4e2d\u6b62\u65f6\u8bb0\u5f55\u65e5\u5fd7\uff0c\u56e0\u4e3a Remix \u7684\u53d6\u6d88\u548c\u7ade\u4e89\u6761\u4ef6\u5904\u7406\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bb8\u591a\u8bf7\u6c42\u88ab\u4e2d\u6b62\u3002"})}),"\n",(0,s.jsx)(r.h3,{id:"\u6d41\u5f0f\u6e32\u67d3\u9519\u8bef",children:"\u6d41\u5f0f\u6e32\u67d3\u9519\u8bef"}),"\n",(0,s.jsxs)(r.p,{children:["\u5f53\u60a8\u901a\u8fc7 ",(0,s.jsx)(r.a,{href:"https://react.dev/reference/react-dom/server/renderToPipeableStream",children:(0,s.jsx)(r.code,{children:"renderToPipeableStream"})})," \u6216 ",(0,s.jsx)(r.a,{href:"https://react.dev/reference/react-dom/server/renderToReadableStream",children:(0,s.jsx)(r.code,{children:"renderToReadableStream"})})," \u6d41\u5f0f\u4f20\u8f93\u60a8\u7684 HTML \u54cd\u5e94\u65f6\uff0c\u60a8\u81ea\u5df1\u7684 ",(0,s.jsx)(r.code,{children:"handleError"})," \u5b9e\u73b0\u4ec5\u4f1a\u5904\u7406\u5728\u521d\u59cb shell \u6e32\u67d3\u671f\u95f4\u9047\u5230\u7684\u9519\u8bef\u3002\u5982\u679c\u5728\u540e\u7eed\u7684\u6d41\u5f0f\u6e32\u67d3\u4e2d\u9047\u5230\u6e32\u67d3\u9519\u8bef\uff0c\u60a8\u9700\u8981\u624b\u52a8\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\uff0c\u56e0\u4e3a\u5230\u90a3\u65f6 Remix \u670d\u52a1\u5668\u5df2\u7ecf\u53d1\u9001\u4e86\u54cd\u5e94\u3002"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\u5bf9\u4e8e ",(0,s.jsx)(r.code,{children:"renderToPipeableStream"}),"\uff0c\u60a8\u53ef\u4ee5\u5728 ",(0,s.jsx)(r.code,{children:"onError"})," \u56de\u8c03\u51fd\u6570\u4e2d\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\u3002\u60a8\u9700\u8981\u5728 ",(0,s.jsx)(r.code,{children:"onShellReady"})," \u4e2d\u5207\u6362\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u4ee5\u4fbf\u77e5\u9053\u9519\u8bef\u662f shell \u6e32\u67d3\u9519\u8bef\uff08\u53ef\u4ee5\u5ffd\u7565\uff09\u8fd8\u662f\u5f02\u6b65\u6e32\u67d3\u9519\u8bef\uff08\u5fc5\u987b\u5904\u7406\uff09\u3002","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1 Node \u7684\u9ed8\u8ba4 ",(0,s.jsx)(r.a,{href:"https://github.com/remix-run/remix/blob/main/packages/remix-dev/config/defaults/entry.server.node.tsx",children:(0,s.jsx)(r.code,{children:"entry.server.tsx"})}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\u5bf9\u4e8e ",(0,s.jsx)(r.code,{children:"renderToReadableStream"}),"\uff0c\u60a8\u53ef\u4ee5\u5728 ",(0,s.jsx)(r.code,{children:"onError"})," \u56de\u8c03\u51fd\u6570\u4e2d\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\u3002","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1 Cloudflare \u7684\u9ed8\u8ba4 ",(0,s.jsx)(r.a,{href:"https://github.com/remix-run/remix/blob/main/packages/remix-dev/config/defaults/entry.server.cloudflare.tsx",children:(0,s.jsx)(r.code,{children:"entry.server.tsx"})}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"\u629b\u51fa\u54cd\u5e94",children:"\u629b\u51fa\u54cd\u5e94"}),"\n",(0,s.jsxs)(r.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5e76\u4e0d\u5904\u7406\u6765\u81ea\u60a8\u7684 ",(0,s.jsx)(r.code,{children:"loader"}),"/",(0,s.jsx)(r.code,{children:"action"})," \u51fd\u6570\u7684\u629b\u51fa ",(0,s.jsx)(r.code,{children:"Response"})," \u5b9e\u4f8b\u3002\u6b64\u5904\u7406\u7a0b\u5e8f\u7684\u76ee\u7684\u662f\u67e5\u627e\u4ee3\u7801\u4e2d\u7684\u9519\u8bef\uff0c\u8fd9\u4e9b\u9519\u8bef\u5bfc\u81f4\u610f\u5916\u7684\u629b\u51fa\u9519\u8bef\u3002\u5982\u679c\u60a8\u5728 ",(0,s.jsx)(r.code,{children:"loader"}),"/",(0,s.jsx)(r.code,{children:"action"})," \u4e2d\u68c0\u6d4b\u5230\u67d0\u79cd\u60c5\u51b5\u5e76\u629b\u51fa 401/404 \u7b49 ",(0,s.jsx)(r.code,{children:"Response"}),"\uff0c\u90a3\u4e48\u8fd9\u662f\u60a8\u4ee3\u7801\u5904\u7406\u7684\u9884\u671f\u6d41\u7a0b\u3002\u5982\u679c\u60a8\u8fd8\u5e0c\u671b\u8bb0\u5f55\u6216\u5c06\u8fd9\u4e9b\u53d1\u9001\u5230\u5916\u90e8\u670d\u52a1\uff0c\u5219\u5e94\u5728\u629b\u51fa\u54cd\u5e94\u65f6\u8fdb\u884c\u5904\u7406\u3002"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>d});var s=n(6540);const t={},c=s.createContext(t);function o(e){const r=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(c.Provider,{value:r},e.children)}}}]);